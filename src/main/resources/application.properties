# ===============================
# SERVER CONFIGURATION
# ===============================
server.port=8080
# Graceful shutdown: completa le richieste in corso prima di spegnersi (vitale per K8s/Docker)
server.shutdown=graceful

# ===============================
# APPLICATION METADATA
# ===============================
spring.application.name=pal-backend

# ===============================
# SCALABILITY (JAVA 21+)
# ===============================
# Abilita i Virtual Threads: il segreto per scalare a 1M utenti su hardware standard
spring.threads.virtual.enabled=true

# ===============================
# DATABASE CONFIGURATION (PostgreSQL)
# ===============================
spring.datasource.url=jdbc:postgresql://localhost:5432/pal_db
spring.datasource.username=pal_user
# In produzione, usa la variabile d'ambiente: ${DB_PASSWORD}
spring.datasource.password=secure_password

# ===============================
# CONNECTION POOL (HikariCP)
# ===============================
# PostgreSQL gestisce meglio pool piccoli ma veloci.
# Non alzare questo valore a caso: 20 Ã¨ sufficiente per migliaia di req/sec con query veloci.
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000

# ===============================
# JPA / HIBERNATE PERFORMANCE
# ===============================
# Disabilita Open Session In View. 
# Evita che le connessioni DB restino aperte mentre Spring converte i JSON.
spring.jpa.open-in-view=false

# In produzione validate va bene (usa Flyway per i cambiamenti), 
# in dev puoi usare 'update' ma con cautela.
spring.jpa.hibernate.ddl-auto=validate

# Batching: Raggruppa le insert. 
# Invece di fare 50 query di rete per inserire 50 cani, ne fa 1 sola.
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# Logging: Tieni spento in prod per risparmiare I/O
spring.jpa.properties.hibernate.format_sql=false

# ===============================
# AI CONFIGURATION (Spring AI)
# ===============================
# La chiave deve essere impostata nelle variabili d'ambiente del server
spring.ai.openai.api-key=${OPENAI_API_KEY}
# Modello da utilizzare (opzionale, default gpt-3.5-turbo o gpt-4o)
spring.ai.openai.chat.options.model=gpt-3.5-turbo